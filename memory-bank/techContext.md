# Technical Context: Технологии и инструменты

## Основные технологии
- **Frontend**: HTML5, CSS3, Vanilla JavaScript (ES6+)
- **Хранение данных**: Markdown-файлы, JSON для индекса и конфигурации
- **Автоматизация**: Node.js, GitHub Actions
- **Хостинг**: GitHub Pages и другие статические хостинги
- **Рендеринг**: Гибридный (SPA + статические HTML-файлы)
- **Интеграция**: Telegram Instant View 2.1
- **Генерация статического сайта**: Кастомный генератор на Node.js с шаблонизатором

## Зависимости
### Производственные
- Минимальный набор библиотек, основной код написан на vanilla JavaScript
- Markdown-парсер (встроенный в клиентский код)
- Gray-matter для работы с frontmatter
- Marked 15.x для конвертации Markdown в HTML
- marked-smartypants для типографского форматирования текста 
- marked-gfm-heading-id для автоматических ID заголовков и навигации
- fs-extra для работы с файловой системой
- path для работы с путями к файлам
- slugify для создания URL-совместимых слагов из названий

### Разработка и инфраструктура
- Node.js (для скриптов генерации индекса и статических HTML)
- `serve` (для локальной разработки)
- Telegram IV Platform (для тестирования шаблонов Instant View)

## Компоненты генератора статического сайта
- **TemplateEngine** - Движок шаблонов с поддержкой переменных, условий, циклов и наследования шаблонов
- **ContentProcessor** - Обработчик контента для чтения Markdown файлов и подготовки данных
- **site-generator.js** - Скрипт, координирующий весь процесс генерации статического сайта
- **postProcessHtml** - Функция для очистки неразрешенных шаблонных тегов в HTML

## Настройка окружения разработки
```bash
# Клонирование репозитория
git clone https://github.com/region23/pavlenko.tech.git
cd pavlenko.tech

# Установка зависимостей
npm install

# Запуск локального сервера разработки
npm start

# Обновление индекса статей
npm run update-index

# Генерация статических HTML-файлов
npm run generate
```

## Команды npm
```json
{
  "scripts": {
    "start": "npx serve dist",
    "dev": "npm run generate && npx serve dist",
    "generate": "node scripts/site-generator.js",
    "build": "npm run generate",
    "deploy": "npm run build && git add . && git commit -m 'Update content' && git push"
  }
}
```

## Структура проекта

```
pavlenko.tech/
├── .github/                   # GitHub Actions workflows
│   └── workflows/
│       └── github-pages.yml   # Workflow для GitHub Pages
├── .cursor/                   # Настройки для Cursor IDE
├── content/                   # Содержимое сайта
│   ├── posts/                 # Статьи в формате Markdown
│   └── about.md               # Страница "О сайте"
├── dist/                      # Сгенерированный статический сайт
│   ├── static/                # Скопированные статические ресурсы
│   ├── posts/                 # HTML-версии статей
│   ├── tags/                  # Страницы тегов
│   ├── index.html             # Главная страница
│   ├── sitemap.xml            # Карта сайта
│   └── ...                    # Другие файлы
├── docs/                      # Документация
├── memory-bank/               # Документация проекта
│   ├── activeContext.md
│   ├── productContext.md
│   ├── progress.md
│   ├── projectbrief.md
│   ├── systemPatterns.md
│   └── techContext.md
├── scripts/
│   ├── generate-index.js      # Скрипт для обновления индекса
│   └── site-generator.js      # Генератор статического сайта
├── src/
│   ├── engine/                # Компоненты движка генератора
│   │   ├── assets.js          # Обработка статических ресурсов
│   │   ├── template.js        # Движок шаблонов
│   │   └── content.js         # Обработчик контента
│   └── templates/             # Шаблоны страниц
│       ├── layouts/           # Базовые макеты
│       ├── partials/          # Повторно используемые части
│       └── pages/             # Шаблоны конкретных страниц
├── static/                    # Статические ресурсы
│   ├── css/                   # Стили сайта
│   ├── js/                    # JavaScript-файлы
│   ├── images/                # Изображения
│   ├── favicon.ico            # Иконка сайта
│   ├── _redirects             # Правила перенаправления для Netlify
│   └── .htaccess              # Правила перенаправления и обнаружения ботов
├── .gitignore                 # Исключения для Git
├── .nojekyll                  # Отключение обработки Jekyll для GitHub Pages
├── config.json                # Конфигурация блога
├── package.json               # Зависимости и скрипты
├── telegram-iv-template.txt   # Шаблон для Telegram Instant View
└── README.md                  # Документация проекта
```

## Рабочие процессы и инструменты

### Локальная разработка
1. Запуск сервера: `npm start`
2. Обновление индекса: `npm run update-index`
3. Генерация статических HTML: `npm run generate`
4. Полная сборка: `npm run build`
5. Просмотр в браузере по адресу: `http://localhost:3000`
6. Тестирование статической версии сайта: `cd dist && python3 -m http.server 8000`

### Деплой
1. Автоматический через GitHub:
   - Коммит изменений: `git commit -m "Сообщение"`
   - Пуш изменений: `git push origin master`
   - GitHub Actions автоматически обновит индекс и сгенерирует статические HTML
   - GitHub Pages автоматически обновит сайт

2. Упрощенный через npm-скрипт:
   - `npm run deploy` (объединяет build, add, commit и push)

### Обновление контента
1. Создание/редактирование .md файлов
2. Использование frontmatter для метаданных
3. Автоматическое обновление индекса и генерация статических HTML при пуше

### Настройка системы
1. Редактирование config.json
2. Выбор цветов, шрифтов, параметров отображения
3. Настройка метаданных сайта (заголовок, описание и т.д.)
4. Настройка навигации и социальных ссылок

### Процесс генерации статического сайта
1. Загрузка контента и конфигурации через ContentProcessor
2. Обработка шаблонов через TemplateEngine
3. Объединение данных с шаблонами
4. Обработка условий, циклов и вложенных шаблонов
5. Постобработка HTML для очистки неразрешенных шаблонных тегов
6. Сохранение финальных HTML-файлов в директории dist
7. Копирование статических ресурсов в директорию dist/static
8. Копирование специальных файлов (favicon.ico, _redirects, .htaccess) в корень dist

### Telegram Instant View
1. Шаблон расположен в файле `telegram-iv-template.txt`
2. Использует спецификацию IV 2.1
3. Процесс тестирования на платформе https://instantview.telegram.org/
4. Структура шаблона:
   - Определение страниц для применения IV (по пути и структуре)
   - Определение основных элементов (тело, заголовок, автор, дата)
   - Обработка многоязычности (поддержка RTL для некоторых языков)
   - Форматирование блоков кода и цитат
   - Обработка изображений и медиа (включая подписи)
   - Форматирование текстовых элементов
   - Обработка таблиц
   - Очистка ненужных элементов (скрипты, соц. кнопки)
   - Маркировка неподдерживаемого контента для корректного отображения
5. Использует переменные и селекторы XPath для точного выбора элементов

## Технические ограничения
- Отсутствие серверной обработки (только статические файлы)
- Все данные должны быть подготовлены заранее или загружены на клиенте
- Необходимость прямого доступа к файлам .md для чтения их содержимого
- Ограничения статических хостингов
- Необходимость перегенерации статических HTML при изменении шаблонов
- Ограничения Telegram Instant View (неподдерживаемые элементы, необходимость ручного тестирования шаблона)
- Ошибки при обработке undefined переменных в шаблонах без надлежащих проверок

## Технические решения
### Гибридный рендеринг
- Для обычных пользователей: SPA с клиентским рендерингом
- Для поисковых роботов: предварительно сгенерированные HTML-файлы
- Механизм определения типа клиента через .htaccess

### Система конфигурации
- Централизованное хранение настроек в config.json
- Глубокое слияние настроек с значениями по умолчанию
- Применение настроек внешнего вида через CSS-переменные
- Доступ к настройкам через функцию get() с поддержкой путей

### Markdown рендеринг
- Библиотека marked 15.x для конвертации Markdown в HTML
- Расширение marked-smartypants для улучшения типографики (преобразование кавычек, тире и т.д.)
- Расширение marked-gfm-heading-id для автоматической генерации ID заголовков в стиле GitHub
- Кастомный рендерер для кода, ссылок и изображений
- Поддержка подсветки синтаксиса в блоках кода

### Шаблонизатор
- Кастомный движок шаблонов на чистом JavaScript
- Поддержка наследования шаблонов через механизм extends
- Включение частей шаблонов через механизм includes
- Условные выражения с поддержкой операторов сравнения
- Циклы для итерации по массивам и коллекциям
- Безопасный доступ к свойствам объектов через getProp
- Постобработка HTML для очистки неразрешенных шаблонных тегов

### Telegram Instant View
- Шаблон в формате IV 2.1
- Поддержка как SPA, так и статических HTML-версий
- Автоматическое определение типа страницы
- Корректировка относительных путей для изображений и ссылок
- Обработка интерактивного контента с альтернативным представлением
- Валидация шаблона для всех существующих статей
- Оптимизация для быстрой загрузки и удобного чтения в Telegram

## Инструменты разработки
- Visual Studio Code / Cursor - основной редактор кода
- Git - система контроля версий
- npm - менеджер пакетов
- GitHub - хостинг репозитория и CI/CD
- Telegram IV Platform - для тестирования шаблонов Instant View
- Python http.server - для локального тестирования статического сайта 