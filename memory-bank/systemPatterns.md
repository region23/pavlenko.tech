# System Patterns: Архитектура блога

## Общая архитектура
Блог построен как статический сайт с гибридным рендерингом - статические HTML-файлы для поисковых роботов и SPA с клиентской маршрутизацией для обычных пользователей. Все данные статей хранятся в виде Markdown-файлов, которые обрабатываются во время сборки. Для генерации HTML используется система шаблонов на основе HTML-файлов.

## Ключевые компоненты
1. **Хранение контента**
   - Markdown-файлы с frontmatter для метаданных
   - Структурированная файловая система (`/content/posts/`, `/content/about/`)
   - JSON-индекс для быстрого доступа к списку статей

2. **Клиентская часть**
   - Чистый JavaScript без фреймворков
   - Модульная структура JS-файлов
   - Обработка Markdown на стороне клиента
   - SPA-маршрутизация с History API
   - Система конфигурации через config.json

3. **Система шаблонов**
   - HTML-файлы шаблонов вместо JavaScript-функций генерации HTML
   - Структура шаблонов: base.html, header.html, footer.html, post.html, post-card.html и т.д.
   - Механизм переменных для подстановки данных (например, {{title}})
   - Кэширование шаблонов для повышения производительности
   - Шаблоны, точно соответствующие дизайну сайта

4. **Автоматизация**
   - Node.js скрипты для генерации статического сайта
   - GitHub Actions для запуска скриптов при каждом пуше
   - GitHub Actions для автоматического деплоя на GitHub Pages
   - Автоматический коммит обновленного контента

5. **SEO и навигация**
   - Настраиваемые заголовки страниц
   - Файл 404.html для обработки несуществующих страниц
   - Файл .htaccess для правил перенаправления и обнаружения поисковых роботов
   - Файл _redirects для хостингов, поддерживающих этот формат
   - Гибридный рендеринг для поисковых роботов

6. **Система конфигурации**
   - Централизованный файл config.json
   - Модуль config.js для загрузки и доступа к настройкам
   - CSS-переменные для настройки внешнего вида
   - Динамическое применение настроек в UI

## Модули системы

### markdownProcessor.js
- Обрабатывает Markdown-контент в HTML
- Извлекает метаданные из frontmatter
- Рассчитывает время чтения статей
- Форматирует даты согласно локали
- Использует библиотеку marked с расширениями

### fileHandler.js
- Управляет файловыми операциями
- Кэширует результаты для улучшения производительности
- Обеспечивает параллельную обработку файлов
- Создает необходимые директории

### configManager.js
- Загружает и валидирует конфигурацию
- Предоставляет доступ к настройкам для других модулей
- Устанавливает значения по умолчанию при необходимости

### templateEngine.js
- Загружает HTML-шаблоны
- Обеспечивает кэширование для повышения производительности
- Подставляет переменные в шаблоны
- Обрабатывает условные блоки и циклы

### siteBuilder.js
- Оркестрирует процесс сборки сайта
- Генерирует все страницы: домашнюю, статьи, теги и т.д.
- Использует все остальные модули
- Обеспечивает параллельную генерацию для оптимизации времени сборки

### cssGenerator.js
- Генерирует CSS-переменные из конфигурации
- Обеспечивает согласованность стилей

## Рабочие процессы

### Добавление новой статьи
1. Создание .md файла в `/content/posts/`
2. Заполнение frontmatter (заголовок, дата, теги и т.д.)
3. Написание содержания статьи в формате Markdown
4. Коммит и пуш в репозиторий
5. GitHub Actions автоматически генерирует статический сайт
6. GitHub Pages обновляет сайт с новым контентом

### Рендеринг для пользователей
1. Пользователь переходит на сайт
2. Загружается SPA-приложение
3. Клиентский маршрутизатор определяет запрошенный URL
4. Загружаются соответствующие данные и рендерится страница
5. При переходе на другую страницу обновляется только содержимое, без перезагрузки страницы

### Рендеринг для поисковых роботов
1. Поисковый робот запрашивает URL
2. Сервер определяет, что запрос от бота (на основе User-Agent)
3. Возвращается предварительно сгенерированный статический HTML
4. Бот получает полностью отрендеренную страницу для индексации

### Настройка внешнего вида
1. Редактирование файла config.json
2. Изменение значений в разделе appearance
3. Запуск скрипта сборки
4. Автоматическая генерация CSS-переменных
5. Обновление внешнего вида сайта 