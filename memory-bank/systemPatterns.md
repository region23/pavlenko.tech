# System Patterns: Архитектура блога

## Общая архитектура
Блог построен как статический SPA (Single Page Application) с клиентской маршрутизацией. Все данные статей хранятся в виде Markdown-файлов, которые обрабатываются как при сборке (для индекса), так и при запросе страницы (для содержимого). Дополнительно реализован гибридный рендеринг, обеспечивающий предварительно сгенерированные HTML-файлы для поисковых роботов и сервисов Instant View.

## Ключевые компоненты
1. **Хранение контента**
   - Markdown-файлы с frontmatter для метаданных
   - Структурированная файловая система (`/content/posts/`, `/content/about/`)
   - JSON-индекс для быстрого доступа к списку статей

2. **Клиентская часть**
   - Чистый JavaScript без фреймворков
   - Модульная структура JS-файлов
   - Обработка Markdown на стороне клиента
   - SPA-маршрутизация с History API
   - Система конфигурации через config.json

3. **Система шаблонов** (запланированная)
   - HTML-файлы шаблонов вместо JavaScript-функций генерации HTML
   - Структура шаблонов: base.html, header.html, footer.html, post.html, post-card.html и т.д.
   - Механизм переменных для подстановки данных (например, {{title}})
   - Кэширование шаблонов для повышения производительности
   - Сохранение текущего дизайна и функциональности

4. **Автоматизация**
   - Node.js скрипт для генерации индекса
   - Node.js скрипт для генерации статических HTML-файлов
   - GitHub Actions для запуска скриптов при каждом пуше
   - GitHub Actions для автоматического деплоя на GitHub Pages
   - Автоматический коммит обновленного индекса

5. **SEO и навигация**
   - Настраиваемые заголовки страниц
   - Файл 404.html для обработки несуществующих страниц
   - Файл .htaccess для правил перенаправления и обнаружения поисковых роботов
   - Файл _redirects для хостингов, поддерживающих этот формат
   - Гибридный рендеринг для поисковых роботов

6. **Система конфигурации**
   - Централизованный файл config.json
   - Модуль config.js для загрузки и доступа к настройкам
   - CSS-переменные для настройки внешнего вида
   - Динамическое применение настроек в UI

## Рабочие процессы

### Добавление новой статьи
1. Создание .md файла в `/content/posts/`
2. Заполнение frontmatter (заголовок, дата, теги и т.д.)
3. Написание содержания статьи в формате Markdown
4. Коммит и пуш в репозиторий
5. GitHub Actions автоматически обновляет индекс и генерирует статические HTML
6. GitHub Pages обновляет сайт с новым контентом

### Обработка статьи для отображения
1. Загрузка `index.json` и `config.json` при инициализации сайта
2. Применение настроек из конфигурации (цвета, шрифты и т.д.)
3. Маршрутизатор определяет запрошенную статью по URL
4. Запрос соответствующего .md файла
5. Разбор frontmatter и рендеринг Markdown
6. Отображение статьи на странице

### Кастомизация шаблонов (запланированная)
1. Редактирование HTML-файлов в директории `/templates`
2. Сохранение переменных для подстановки в шаблоны (например, {{title}}, {{content}})
3. Автоматическое применение изменений при следующей сборке
4. Возможность создания разных вариантов шаблонов через систему тем

### Обработка запросов от поисковых роботов
1. .htaccess проверяет User-Agent на признаки поискового робота
2. Если запрос от бота, происходит перенаправление на статическую HTML-версию
3. Робот получает полноценный HTML без необходимости выполнения JavaScript

### Процесс деплоя
1. Пуш изменений в репозиторий
2. GitHub Actions запускает скрипт обновления индекса
3. GitHub Actions запускает скрипт генерации статических HTML-файлов
4. Обновленные файлы коммитятся в репозиторий
5. GitHub Pages собирает и публикует обновленную версию

## Технические решения

### Работа с Markdown
- Использование чистого Markdown без расширений
- Разбор frontmatter для извлечения метаданных
- Генерация slug на основе имени файла или явного указания

### Система шаблонов (запланированная)
- Переход от JavaScript-генерируемых шаблонов к HTML-файлам
- Создание директории `/templates` с базовыми шаблонами
- Обновление templateEngine.js для загрузки и рендеринга HTML-шаблонов
- Простой механизм переменных для подстановки данных
- Механизм кэширования шаблонов для улучшения производительности

### Обновление индекса
- Сканирование всех .md файлов в директории posts
- Извлечение метаданных из frontmatter
- Сортировка статей по дате (новые сначала)
- Сохранение в `index.json`

### Маршрутизация
- Использование клиентской маршрутизации через History API
- Паттерны URL: `/` (главная), `/posts/:slug` (статья), `/about` (о блоге), `/tags` (теги)
- Обработка 404 ошибок для несуществующих страниц

### Система конфигурации
- Разделение конфигурации на логические секции (site, navigation, social, appearance, content)
- Глубокое слияние пользовательских настроек с настройками по умолчанию
- Функция доступа к настройкам с поддержкой пути (например, "appearance.colors.primary")
- Динамическое применение настроек внешнего вида через CSS-переменные

### Гибридный рендеринг
- Предварительная генерация HTML-файлов для всех статей
- Одинаковый алгоритм рендеринга для SPA и статических файлов
- Интеллектуальная маршрутизация запросов через .htaccess
- Поддержка Telegram Instant View с единым шаблоном для обоих типов страниц 