# Active Context: Текущее состояние проекта

## Текущий фокус
Переход к использованию HTML-файлов в качестве шаблонов для повышения настраиваемости блога, а также продолжение работы над гибридным рендерингом для поддержки поисковых роботов и Telegram Instant View.

## Последние изменения
1. **Реализована система конфигурации** - Создан файл `config.json` и модуль `js/config.js` для централизованного управления настройками блога.
2. **Добавлен гибридный рендеринг** - Реализована система, предоставляющая статические HTML-файлы для поисковых роботов и SPA для обычных пользователей.
3. **Добавлена поддержка Telegram Instant View** - Создан шаблон для Telegram IV и настроена совместимость как с SPA, так и со статическими HTML-файлами.
4. **Улучшен дизайн для мобильных устройств** - Оптимизирован интерфейс для мобильных устройств, включая отключение sticky-header и улучшение отступов списков.
5. **Расширена документация** - Созданы документы по гибридному рендерингу и настройке Telegram Instant View.
6. **Добавлены новые npm-скрипты** - Добавлены скрипты для генерации статических HTML-файлов и полной сборки проекта.
7. **Обновлен .htaccess для обнаружения ботов** - Добавлена логика для определения поисковых роботов и перенаправления на статические HTML-файлы.
8. **Настроена передача метаданных через config.json** - Заголовок, описание, язык и другие метаданные сайта теперь управляются через конфигурацию.
9. **Обновлен GitHub workflow** - Workflow для обновления контента теперь генерирует статические HTML-файлы при каждом обновлении постов или шаблонов.
10. **Обновление библиотеки Marked (22.03.2025)** - Обновили библиотеку marked с версии 5.1.2 до версии 15.0.7 для решения проблем с устаревшими функциями.
11. **Установка расширений для Marked (22.03.2025)** - Добавлены marked-smartypants для типографского форматирования текста и marked-gfm-heading-id для корректной работы ID заголовков и навигации.
12. **Обновление рендерера (22.03.2025)** - Изменили API рендерера в scripts/generate-static.js для совместимости с marked 15.x.
13. **Исправлены оглавления статей (22.03.2025)** - Настроена корректная работа якорных ссылок в оглавлении статей.
14. **Планирование перехода на HTML-шаблоны (22.03.2025)** - Разработан план миграции с JavaScript-генерируемых шаблонов на HTML-файлы для улучшения возможностей кастомизации.

## Текущий статус

Статический блог полностью функционален. Основные компоненты работают:
- Генерация индекса статей
- Рендеринг Markdown в HTML
- Генерация статических страниц для SEO и предпросмотра
- Навигация по заголовкам внутри статей

## Приоритетные задачи

1. **Миграция на HTML-шаблоны** - Перевести систему генерации HTML с JavaScript-функций на HTML-файлы шаблонов для улучшения возможностей кастомизации.
2. **Тестирование на мобильных устройствах** - Убедиться, что сайт корректно отображается на разных устройствах.
3. **Оптимизация производительности** - Рассмотреть возможности кэширования для ускорения генерации статического контента.
4. **Автоматическое оглавление** - Добавление автоматической генерации оглавления для статей с использованием функции getHeadingList из marked-gfm-heading-id.

## Активные проблемы
1. **Ограниченные возможности кастомизации шаблонов** - Текущая реализация шаблонов в виде JavaScript-функций затрудняет кастомизацию дизайна для обычных пользователей.
2. **Адаптация для всех браузеров** - Необходимо проверить работу гибридного рендеринга в различных браузерах.
3. **Оптимизация загрузки ресурсов** - Улучшить стратегию загрузки JavaScript и CSS для ускорения первой отрисовки.
4. **Переводы для интерфейса** - Реализовать механизм локализации для элементов интерфейса.

## Следующие шаги
1. **Создать систему HTML-шаблонов** - Разработать директорию templates с HTML-файлами шаблонов для замены JavaScript-функций генерации HTML.
2. **Интегрировать Google Analytics** - Добавить опциональное подключение Google Analytics через конфигурацию.
3. **Расширить систему шаблонов** - Добавить возможность выбора различных тем и шаблонов через конфигурацию.
4. **Добавить механизм комментариев** - Интегрировать систему комментариев (Utterances или Disqus) с настройкой через конфигурацию.
5. **Оптимизировать изображения** - Автоматизировать оптимизацию и адаптивность изображений в статьях.
6. **Улучшить SEO** - Добавить генерацию sitemap.xml и robots.txt.
7. **Реализовать кастомизацию через админ-панель** - Создать простую админ-панель для визуального редактирования конфигурации.

## Активные решения и соображения
1. **Миграция на HTML-шаблоны** - Переход от JavaScript-функций генерации HTML к файловым HTML-шаблонам повысит гибкость и упростит кастомизацию для обычных пользователей, сохраняя текущий дизайн.
2. **Использование чистого JavaScript** - Проект намеренно избегает использования фреймворков для минимизации зависимостей и увеличения скорости загрузки.
3. **Гибридный подход к рендерингу** - Сочетание преимуществ SPA (быстрая навигация) и статических страниц (SEO, совместимость).
4. **Централизованная конфигурация** - Все настройки хранятся в едином файле `config.json` для упрощения кастомизации.
5. **Прогрессивное улучшение** - Сайт должен быть доступен даже при отключенном JavaScript благодаря статическим версиям.
6. **Минимальные зависимости** - Только необходимые npm-пакеты для сохранения скорости загрузки и простоты обслуживания.
7. **Автоматизация через GitHub Actions** - Использование CI/CD для упрощения обновления сайта, индекса статей и генерации статических HTML.
8. **Темный режим** - Поддержка светлой и темной темы с настройкой через конфигурацию.
9. **Telegram интеграция** - Оптимизация для чтения и шаринга статей через Telegram Instant View.
10. **Архитектура рендеринга Markdown** - Использование библиотеки marked с расширениями для эффективной обработки контента.
11. **Подход к оглавлению** - Заголовки получают автоматические ID с помощью marked-gfm-heading-id для удобной навигации. 