# Telegram Instant View для Pavlenko.Tech

## Обзор

Telegram Instant View (IV) - это технология, которая позволяет Telegram быстро отображать веб-страницы в минималистичном виде, адаптированном для мобильных устройств. Данная документация описывает реализацию шаблона IV для блога Pavlenko.Tech.

## Основные сведения

- **Версия IV**: 2.1 (актуальная на момент реализации)
- **Файл шаблона**: `telegram-iv-template.txt` в корне проекта
- **Платформа для тестирования**: [instantview.telegram.org](https://instantview.telegram.org/)

## Структура шаблона

Шаблон состоит из нескольких логических секций, каждая из которых отвечает за определенную часть преобразования HTML-страницы блога в формат Telegram IV.

### 1. Определение целевых страниц

```
# Применяем шаблон только для статических страниц постов
?path: /posts/.+

# Генерируем IV только для страниц со статьёй
?exists: //article[contains(@class, "post")]
```

Эти условия гарантируют, что шаблон будет применяться только к страницам с постами блога, а не к другим страницам сайта.

### 2. Информация о сайте

```
site_name: "Pavlenko.Tech"
#channel: https://t.me/pavlenkodev
```

Определяет название сайта для отображения в IV. Закомментированная строка позволяет связать IV с Telegram-каналом.

### 3. Основные элементы статьи

```
body: //div[contains(@class, "post-content")]
title: //article[contains(@class, "post")]/header[contains(@class, "post-header")]/h1
author: //span[contains(@class, "post-author")]/text()
published_date: //div[contains(@class, "post-meta")]/time

$article: //article[contains(@class, "post")]

cover: $article//img[1]

description: //*[contains(@class, "post-summary")]
```

Эта секция определяет основные элементы статьи:
- Основное содержимое (`body`)
- Заголовок статьи (`title`)
- Автора (`author`)
- Дату публикации (`published_date`)
- Переменную для доступа к статье (`$article`)
- Обложку статьи (`cover`)
- Краткое описание для превью (`description`)

### 4. Форматирование и языковая поддержка

```
@set_attr(dir, rtl): //html[@dir="rtl" or @lang="ar" or @lang="he" or @lang="fa"]

@replace_tag(<pre>): //pre/code
@set_attr(class, @class): //pre/code[@class]

@wrap(<blockquote>): //blockquote
@wrap(<cite>): //blockquote//cite
```

Эти правила обеспечивают:
- Поддержку языков с письмом справа налево (RTL)
- Корректное отображение блоков кода
- Правильное форматирование цитат

### 5. Обработка изображений

```
@wrap(<figure>): //img
@wrap(<figure>): //img[@alt and not(parent::figure)]
@append(<figcaption>): //img[@alt]/@alt

$rel_img: //img[@src and (not(starts-with(@src, "http://")) and not(starts-with(@src, "https://")))]
@set_attr(src, concat("https://pavlenko.tech/", @src)): $rel_img
```

Эти правила обеспечивают:
- Оформление изображений с подписями
- Исправление относительных путей для изображений

### 6. Форматирование текстовых элементов

```
@wrap(<h2>): //h2
@wrap(<h3>): //h3
@wrap(<h4>): //h4

@wrap(<ul>): //ul
@wrap(<ol>): //ol

$rel_links: //a[@href and not(starts-with(@href, "http")) and not(starts-with(@href, "https")) and not(starts-with(@href, "#"))]
@set_attr(href, concat("https://pavlenko.tech/", @href)): $rel_links

@wrap_inner(<related>): //div[contains(@class, "post-tags")]/a
```

Эти правила обеспечивают:
- Корректное форматирование заголовков
- Правильное отображение списков
- Исправление относительных ссылок
- Добавление блока "Похожие статьи" для тегов

### 7. Обработка таблиц

```
@wrap(<table>): //table
```

Правило для корректного отображения таблиц.

### 8. Очистка от ненужных элементов

```
@remove: //div[contains(@class, "social-share")]
@remove: //div[contains(@class, "table-of-contents")]
@remove: //script
```

Эти правила удаляют элементы, которые не нужны для IV:
- Кнопки социальных сетей
- Оглавление статьи (оно заменяется встроенным оглавлением Telegram)
- JavaScript-код

### 9. Маркировка неподдерживаемого контента

```
@unsupported: //iframe
@unsupported: //form
@unsupported: //canvas
@unsupported: //div[contains(@class, "interactive-element")]
```

Эти правила помечают элементы, которые не поддерживаются в Telegram IV, чтобы предотвратить ошибки рендеринга.

## Тестирование шаблона

1. Загрузите файл `telegram-iv-template.txt` на платформу [instantview.telegram.org](https://instantview.telegram.org/)
2. Введите URL статьи для проверки работы шаблона
3. Используйте вкладку "Compare" для сравнения результата с исходной страницей
4. Проверьте все типы контента, используемые в статьях:
   - Заголовки разных уровней
   - Списки (нумерованные и маркированные)
   - Изображения с подписями и без
   - Блоки кода
   - Таблицы
   - Цитаты
   - Ссылки (внешние и внутренние)

## Ограничения и проблемы

1. **Неподдерживаемые элементы**:
   - iframe (видео, интерактивные элементы)
   - canvas (графики, интерактивная графика)
   - form (формы ввода)
   - Скрипты и интерактивные элементы
   
2. **Обработка многоязычного контента**:
   - Особое внимание к RTL языкам (арабский, иврит, персидский)
   
3. **Относительные пути**:
   - Необходимость преобразования всех относительных путей в абсолютные

## Рекомендации по написанию статей с учётом IV

1. **Изображения**:
   - Всегда добавляйте атрибут `alt` для изображений (он будет использован как подпись)
   - Избегайте сложных схем с наложением изображений
   
2. **Интерактивный контент**:
   - Предоставляйте альтернативное статическое содержимое для интерактивных элементов
   - Для видео добавляйте скриншот с ссылкой на источник
   
3. **Форматирование**:
   - Используйте стандартные элементы форматирования Markdown
   - Избегайте сложных таблиц с объединенными ячейками
   
4. **Структура контента**:
   - Используйте иерархию заголовков для логической структуры документа
   - Размещайте самую важную информацию в начале статьи

## Обновление шаблона

При внесении изменений в HTML-структуру блога необходимо актуализировать шаблон:

1. Обновите селекторы в шаблоне, если изменилась структура DOM
2. Протестируйте шаблон на всех существующих статьях
3. Проверьте новые типы контента, если они были добавлены 